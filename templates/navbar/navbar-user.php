<?php
if(isset($_SESSION['id'])){
//User is logged in, display user menu

?>

<li class="nav-item dropdown nav-main-user"><a class="nav-link pe-0" id="navbarDropdownUser" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <div class="avatar avatar-2xl">
                  <img style="background-color: white;" class="rounded-circle" src="/assets/img/users/<?php echo $userID; ?>.svg" alt="<?php echo $userName; ?>">
                </div>
              </a>
              <div class="dropdown-menu dropdown-menu-end py-0" aria-labelledby="navbarDropdownUser">
                <div class="bg-white dark__bg-1000 rounded-2 py-2">
<?php
$timeNow = strtotime("now");
$weekly = $userWeekly;
$timeDiff = $weekly - $timeNow;
if($timeDiff > 0){
//Time difference exists which means user has active subscription


$t1 = date("Y-m-d H:i:s", $userWeekly);
$date_expire = $t1;    
$date = new DateTime($date_expire);
$now = new DateTime();

$timeLeft = $date->diff($now)->format("%D:%H:%I");
$timeLeftNice = $date->diff($now)->format("%d days, %h hours and %i minuts");


$start = date('Y-m-d H:i:s',(strtotime ( '-7 day' , strtotime ($t1) ) ));
$end = $t1;

$current = strtotime("now");
$start = strtotime($start);
$end = strtotime($end);

$o = $end - $start;
$o2 = $end - $current;

$of = $o2 / $o;
$c = round($of, 2) * 100;
?> 

<a class="dropdown-item fw-bold text-warning" href="/weekly/" data-bs-placement="bottom" data-bs-toggle="tooltip" title="Time Left: <?php echo $timeLeftNice; ?>" data-bs-original-title="Time Left: <?php echo $timeLeftNice; ?>">

    <svg class="svg-inline--fa fa-crown fa-w-20 me-1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="crown" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" data-fa-i2svg=""><path fill="currentColor" d="M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"></path></svg><!-- <span class="fas fa-crown me-1"></span> Font Awesome fontawesome.com -->
    <span>Weekly Horoscope</span>


<svg class="svg-inline--fa fa-crown fa-w-20 me-1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="crown" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" data-fa-i2svg=""><path fill="currentColor" d="M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"></path></svg><!-- <span class="fas fa-crown me-1"></span> Font Awesome fontawesome.com -->
<br>

<div class="progress">
<div class="progress-bar progress-bar-striped bg-warning progress-bar-animated" id="progress-toggle" role="progressbar" aria-valuenow="<?php echo $c; ?>" aria-valuemin="0" aria-valuemax="100" style="width: <?php echo $c; ?>%">
<?php echo $c; ?>%</div></div>
</a>

<?php 
}else{ 
//Time difference is less than 0 which means user has inactive subscription
?>
<a class="dropdown-item fw-bold text-warning" href="/weekly/"><svg class="svg-inline--fa fa-crown fa-w-20 me-1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="crown" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" data-fa-i2svg=""><path fill="currentColor" d="M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"></path></svg><!-- <span class="fas fa-crown me-1"></span> Font Awesome fontawesome.com -->
<span>Purchase Weekly Horoscope</span></a>


<?php 
} ?>

<div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="/dashboard/"><i class="fas fa-shopping-cart"></i> Your Orders (<b><?php echo $userOrders; ?></b>)</a>
                  <a class="dropdown-item" href="/dashboard/profile/"><i class="fas fa-user-edit"></i> Edit Profile</a>
                  <!--<a class="dropdown-item" href="/invite-friends/">Invite Your Friends</a>-->
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="/logout/"><i class="fas fa-power-off"></i> Logout</a>
                </div>
              </div>
</li>

<?php 
}else{ 
//User is NOT logged in, display default menu
?>

<li class="nav-item dropdown"><a class="nav-link pe-0" id="navbarDropdownUser" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <div class="avatar avatar-2xl">
                  <img class="rounded-circle" src="/assets/img/default-avatar.jpg" alt="Visitor">
                </div>
              </a>
              <div class="dropdown-menu dropdown-menu-end py-0" aria-labelledby="navbarDropdownUser">
                <div class="bg-white dark__bg-1000 rounded-2 py-2">
                  <a class="dropdown-item fw-bold text-warning" href="#!"><svg class="svg-inline--fa fa-crown fa-w-20 me-1" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="crown" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" data-fa-i2svg=""><path fill="currentColor" d="M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"></path></svg><!-- <span class="fas fa-crown me-1"></span> Font Awesome fontawesome.com --><span>Go Pro</span></a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="#!">Set status</a>
                  <a class="dropdown-item" href="pages/user/profile.html">Profile &amp; account</a>
                  <a class="dropdown-item" href="#!">Feedback</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="pages/user/settings.html">Settings</a>
                  <a class="dropdown-item" href="pages/authentication/card/logout.html">Logout</a>
                </div>
              </div>
</li>


<?php } //End if else Loop?>