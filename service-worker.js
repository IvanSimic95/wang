const urlB64ToUint8Array=e=>{e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),a=new Uint8Array(t.length);for(let e=0;e<t.length;++e)a[e]=t.charCodeAt(e);return a},saveSubscription=async e=>{const t=await fetch("https://beacon.crowdpower.io/customers/push",{method:"post",headers:{Authorization:"Bearer "+self.params.project_key,"Content-Type":"application/json"},body:JSON.stringify({user_id:self.params.user_id,user_token:self.params.user_token,subscription:e})});return t.json()};self.addEventListener("install",()=>{const e=new URL(self.location);var t=e.search.substring(1);self.params=JSON.parse('{"'+decodeURI(t).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}),self.addEventListener("activate",async()=>{try{var e={applicationServerKey:urlB64ToUint8Array("BHaVWj3udzHUICQTDpjU2eJkiehNxvr7YT4v_mQucGr1zjokP_lmPDy_paO8HSRxeMbgNwcGg7t2lDb6RYX7Dgs"),userVisibleOnly:!0},t=await self.registration.pushManager.subscribe(e);await saveSubscription(t)}catch(e){console.log(e)}}),self.addEventListener("push",e=>{e.data&&(e=e.data.json(),self.registration.showNotification(e.title,{icon:e.icon,body:e.body,image:e.image,data:{url:e.click_action}}))}),self.addEventListener("notificationclick",e=>{e.notification.close(),e.waitUntil(self.clients.openWindow(e.notification.data.url))});